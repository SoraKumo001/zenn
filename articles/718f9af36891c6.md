---
title: "supabase + GraphQL ã® String æ¤œç´¢ã§ like ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹"
emoji: "ğŸ¥"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [supabase, graphql, postgresql]
published: true
---

# supabase ã¯ãã®ã¾ã¾ã ã¨ GraphQL ã® filter ã§ like ãŒä½¿ãˆãªã„

RestAPI ã«ã¯å­˜åœ¨ã—ã¦ã„ã‚‹ã®ã§ã™ãŒã€GraphQL ã«ã¯ like æ¼”ç®—å­ãŒå­˜åœ¨ã—ã¦ã„ã¾ã›ã‚“ã€‚ãã®ã¾ã¾ã ã¨ç„¡ç†ã§ã™ã€‚

# æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹

ç„¡ã„ã‚‚ã®ã¯ä»•æ–¹ãŒãªã„ã®ã§ä½œã‚Šã¾ã™ã€‚
ä»¥ä¸‹ã® SQL ã‚’å®Ÿè¡Œã™ã‚‹ã¨ GraphQL ã®ã‚¹ã‚­ãƒ¼ãƒã« like ãŒå‡ºç¾ã—ã¾ã™ã€‚

```sql
create or replace function graphql.text_to_comparison_op(text)
    returns graphql.comparison_op
    language sql
    immutable
    as
$$
    select
        case $1
            when 'eq' then '='
            when 'lt' then '<'
            when 'lte' then '<='
            when 'neq' then '<>'
            when 'gte' then '>='
            when 'gt' then '>'
            when 'like' then 'like'
            else graphql.exception('Invalid comaprison operator')
        end::graphql.comparison_op
$$;


insert into graphql._field(parent_type_id, type_id, constant_name, is_not_null, is_array, description)
    select
        gt.id as parent_type_id,
        gt.graphql_type_id type_id,
        ops.constant_name as constant_name,
        false,
        false,
        null::text as description
    from
        graphql.type gt
        join (
            values
                ('like')
        ) ops(constant_name)
            on true
    where
        gt.meta_kind = 'FilterType'
        and gt.graphql_type_id = graphql.type_id('String');

alter type graphql.comparison_op add value 'like';
```

# ApolloStudio ã§ã‚¹ã‚­ãƒ¼ãƒã®ç¢ºèª

ä»¥ä¸‹ã€ãã¡ã‚“ã¨è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™

![](/images/718f9af36891c6/2022-04-25-22-12-25.png)

# ã¾ã¨ã‚

supabase ã§ GraphQL ã‚’ä½¿ã£ã¦ã„ã‚‹äººã¯å°‘ãªãã†ã§ã™ãŒã€å›°ã£ã¦ã„ã‚‹åŒå£«ã®åŠ©ã‘ã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚
