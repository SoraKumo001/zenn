---
title: "Prisma@7 はなぜ遅くなってしまったのか"
emoji: "🕌"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [prisma, drizzle, wasm, cloudflare, database]
published: true
---

# Prisma@7 の現状

2025/11/17 に Prisma の公式 Blog で 7.0.0 が発表されました。

https://www.prisma.io/blog/announcing-prisma-orm-7-0-0

- Moving away from Rust
- 90% smaller bundle output
- 3x faster query execution
- Significantly lower CPU and memory utilization
- Simpler deployments for Vercel Edge and Cloudflare Workers

Rust から脱却し、バンドルサイズが 90%縮小、クエリの実行が 3 倍速、CPU 私用率やメモリ消費の低減、Edge 環境や Cloudflare への導入が簡単になったという内容です。

現実はこの issue に集約されています。

https://github.com/prisma/prisma/issues/28845

ベンチマークの結果、「3 倍速」どころか**逆に遅くなっている**ケースが報告されています。さらに、v7 以降に発生した大量のバグによって issues が埋め尽くされており、基本的な使い方を示す `Prisma Examples` リポジトリですら、テストが通らない壊滅的な状態にあります。

[Prisma Examples: CI/CD Status](https://github.com/prisma/prisma-examples/actions)

# Prisma の動作種別

![](/images/2c90f28ba494e7/2025-12-26-22-46-10.png)

現状使われている Prisma の動作の流れは図に示すとおりです。Prisma@7 の基本構成が 4 です。では順番に解説します。

## ① PrismaEngine (Rust Native)

従来の方式です。PrismaClient に渡したパラメータを Rust 製のネイティブバイナリ（Engine）で処理し、DB とやり取りします。

- **長所:** 各 DB ごとの Adapter を必要とせず、Rust 製ドライバで完結する。
- **短所:** クエリやデータをやり取りする際、**JSON への変換（シリアライズ/デシリアライズ）**が大きなボトルネックとなり、データ量が多いほどパフォーマンスが低下します。

ちなみに PrismaClient と PrismaEngine の間の経路は、ネットワーク経由で行うことも可能であり、それを利用したのが[Prisma Accelerate](https://www.prisma.io/accelerate)というサービスになります。

## ② PrismaEngine (Rust Wasm)

Edge 環境（Cloudflare 等）に対応するため、Engine を WebAssembly 化した方式です。

- **変化:** バイナリサイズは 90% 削減されましたが、Rust 製 DB ドライバの移植が困難だったため、**JavaScript 製の Adapter** を介する手間が増えました。

## ③ QueryCompiler (Rust Wasm)

データの受け取りを高速化するために導入された新方式です。

- **仕組み:** DB からデータを受け取る機能を PrismaClient 側に持たせ、QueryCompiler は「パラメータを SQL に変換する」役割に特化させました。
- **結果:** データの戻り値における変換ロスが減り、巨大なデータの取得は高速化（これが「3 倍速」の根拠）しました。
- **課題:** 一方で、**「パラメータ → SQL」への変換作業が新たなボトルネック**となり、細かいクエリでは逆に速度が低下。キャッシュによる解決が予定されていますが、都度起動するサーバーレス環境では恩恵を受けにくい懸念があります。

## ④ QueryCompiler (Rust Wasm + TypeScript)

Prisma 7 の基本構成です。PrismaClient の生成コードを TypeScript 化しました。

- **仕組み:** これまで `node_modules` 内に JS として出力されていた実コードを、ユーザーコード（TS）として出力し、ユーザー側のビルド対象に含めます。
- **実態:** Rust から脱却した」と謳われていますが、実際は**PrismaClient の部分のみを TS にしただけ**であり、コアロジックは依然として Rust 製の `.wasm` です。
- **退化:** 従来の方式では `package.json` の `exports` フィールドにより実行環境（Node/Edge/Deno 等）が自動判別されていましたが、この方式では `schema.prisma` で環境を手動指定する必要があり、利便性はむしろ低下しています。

# まとめ

Prisma 7 は、速度を語る以前に「バグの修正」と「Example の正常化」というスタートラインにすら立てていないのが現状です。この混沌とした状況での正式リリースは、エコシステムに対する信頼を大きく損なう結果となっています。

また、Prisma は多機能なのが仇になって、クエリパラメータを素直に SQL に変換することができません。どうしても複雑な変換ロジックを介する必要があります。Prisma がどんなに改良を重ねようと、前提条件が他の ORM と比べると非常に不利なのです。

こうした状況を受け、私は自身は ORM を **Prisma から Drizzle ORM へ移行**することにしました。現在ベータ版である Drizzle の API V2 に関して、なぜか [Prisma の Blog](https://www.prisma.io/blog/convergence) でわかりやすく紹介されています。findMany などの部分は Prisma にかなり寄せているのが見て取れます。リレーションされたデータの取り出しなどはかなり扱いやすくなっています。ただし一歩踏み込むと、機能で Prisma には遠くおよびません。

私のは DB へのアクセスは、フロント・バックエンド問わず、必ず GraphQL を通すようにしています。その移行過程必要になったので、Drizzle のスキーマ情報から GraphQL のオペレーションを自動生成するツールを開発・公開しました。

[npm: pothos-drizzle-generator](https://www.npmjs.com/package/pothos-drizzle-generator)

これに関する詳細な導入手法などは、また別の記事で詳しく解説する予定です。
