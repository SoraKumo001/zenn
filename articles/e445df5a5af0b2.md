---
title: "React18ã®æ–°æ©Ÿèƒ½ã‚’ä¸€é€šã‚Šä½¿ã£ã¦ã¿ã‚‹"
emoji: "ğŸ”¥"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [react, nextjs, typescript]
published: false
---

# useInsertionEffect ã®å‹•ä½œã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®æ¤œè¨¼

useInsertionEffect ã¯ DOM ãŒæ›´æ–°ã•ã‚Œã‚‹å‰ã«å‘¼ã³å‡ºã•ã‚Œã‚‹ hook ã§ã™ã€‚æ™®é€šã« React ã‚’ä½¿ã£ã¦ã„ã‚‹é™ã‚Šã€ç›´æ¥ãŠä¸–è©±ã«ãªã‚‹ã“ã¨ã¯è€ƒãˆã«ãã„ã§ã™ãŒã€å‹•ä½œã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®æ¤œè¨¼ã¯ã—ã¦ãŠã„ãŸæ–¹ãŒè‰¯ã„ã§ã—ã‚‡ã†ã€‚

```ts
import {
  useEffect,
  useInsertionEffect,
  useLayoutEffect,
  useState,
} from "react";

let count = 1;

const Test = () => {
  useEffect(() => {
    console.log(count++, "effect start");
    return () => console.log(count++, "effect end");
  }, []);
  useLayoutEffect(() => {
    console.log(count++, "layout start");
    return () => console.log(count++, "layout end");
  }, []);
  useInsertionEffect(() => {
    console.log(count++, "insertion start");
    return () => console.log(count++, "insertion end");
  });
  console.log(count++, "Test");
  return (
    <div ref={(v) => console.log(count++, v ? "dom start" : "dom end")}>
      aaaa
    </div>
  );
};

const Page = () => {
  const [visible, setVisible] = useState(true);
  useEffect(() => {
    setVisible(false);
  });
  return visible && <Test />;
};

export default Page;
```

- å®Ÿè¡Œçµæœ

```
1 'Test'
2 'start' 'insertion'
3 'start' 'dom'
4 'start' 'layout'
5 'start' 'effect'
6 'end' 'layout'
7 'end' 'insertion'
8 'end' 'dom'
9 'end' 'effect'
```

useInsertionEffect ã¯å¸¸ã« DOM ã®å‡¦ç†ãŒå…¥ã‚‹ç›´å‰ã«å®Ÿè¡Œã•ã‚Œã¦ã„ã¾ã™ã€‚å…¨èˆ¬çš„ãªæµã‚Œã¨ã—ã¦é–‹å§‹ã¨çµ‚äº†ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒå¾Œå…¥ã‚Œå…ˆå‡ºã—ã¨ã¯ç•°ãªã‚‹ã¨ã„ã†éƒ¨åˆ†ã¯æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚

ã¡ãªã¿ã« SSR æ™‚ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã€Effect ç³»ã® hook ã‚„ DOM ã«é–¢ã™ã‚‹å‡¦ç†ãŒå…¨ãè¡Œã‚ã‚Œã¾ã›ã‚“ã€‚

```
1 'Test'
```

# Suspense ã¨ useId ã§ SSR-Streaming ã‚’å®Ÿç¾ã™ã‚‹

SSR-Streaming ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã€Next.js ã®è¨­å®šã§`runtime`ã®æŒ‡å®šã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

- nextjs.config.js

```js
// @ts-check
/**
 * @type { import("next").NextConfig}
 */
const config = {
  experimental: {
    runtime: "edge",
  },
};
module.exports = config;
```

- src/pages/index.tsx

```tsx
import { Suspense, useId, useRef, useState } from "react";

const isServer = typeof window === "undefined";

const StreamLoader = <T,>({
  loader: proc,
  onLoad,
}: {
  loader: () => Promise<T>;
  onLoad?: (value: T) => void;
}) => {
  const property = useRef<{ promise?: Promise<T>; value?: T }>({}).current;
  const id = useId();
  if (!isServer && property.value === undefined) {
    const node = document.getElementById(id);
    if (node) {
      property.value = JSON.parse(node.innerHTML);
      setTimeout(() => onLoad?.(property.value));
    }
  }
  if (property.value === undefined && !property.promise)
    property.promise = proc().then((v) => {
      property.value = v;
      onLoad?.(property.value);
      return v;
    });
  const Loader = () => {
    if (!property.value) throw property.promise;
    return (
      <script
        id={id}
        type="application/json"
        dangerouslySetInnerHTML={{
          __html: JSON.stringify(property.value),
        }}
      />
    );
  };
  return (
    <Suspense>
      <Loader />
    </Suspense>
  );
};

const Page = () => {
  const [value, setvalue] = useState();
  const loader = async () => {
    const result = await fetch(
      `https://www.jma.go.jp/bosai/common/const/area.json`
    )
      .then((r) => r.json())
      .catch(() => null);
    await new Promise((r) => setTimeout(r, 3000));
    return result;
  };
  return (
    <>
      <div>
        {value === undefined ? (
          "Loading"
        ) : (
          <pre>{JSON.stringify(value, undefined, "  ")}</pre>
        )}
      </div>
      <StreamLoader loader={loader} onLoad={setvalue} />
    </>
  );
};

export default Page;
```

StreamLoader ã« SSR-Streaming ã§éåŒæœŸãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€ãŸã‚ã®å‡¦ç†ã‚’ä½œã£ã¦ã„ã¾ã™ã€‚èª­ã¿è¾¼ã‚“ã§ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã¯æ°—è±¡åºã®åœ°åŸŸåä¸€è¦§ã§ã™ã€‚åˆ†ã‹ã‚Šã‚„ã™ã„ã‚ˆã†ã« 3 ç§’ã®ã‚¦ã‚¨ã‚¤ãƒˆã‚’å…¥ã‚Œã¦ã„ã¾ã™ã€‚

SSR-Streaming ã¯`<Suspense>`å†…ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ Promise ã‚’ throw ã™ã‚‹ã“ã¨ã§å®Ÿç¾ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã£ã¦ Promise ãŒå®Œäº†ã™ã‚‹ã¾ã§ã‚µãƒ¼ãƒå´ãŒéåŒæœŸå¾…ã¡ã‚’è¡Œã„ã€ãã‚Œä»¥å¤–ã®éƒ¨åˆ†ã‚’å…ˆã«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«è¿”ã—ã¾ã™ã€‚ãã—ã¦ Promise ãŒ resolve ã•ã‚Œã‚‹ã¨æ®‹ã‚Šã®ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã§è¿”ã—ã¾ã™ã€‚

ã“ã“ã§é‡è¦ãªã®ã¯ã€Streaming ã§è¿”ã™ã®ã¯ UI ã‚’æŒã£ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ãªãã¨ã‚‚è‰¯ã„ã¨è¨€ã†ã“ã¨ã§ã™ã€‚å®Ÿéš›ã«ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°æ™‚ã«è¿½åŠ ã§æ¬²ã—ã„ã®ã¯ã€ãƒ‡ãƒ¼ã‚¿ã§ã‚ã£ã¦ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ¸ˆã¿ã® HTML ã§ã¯ãªã„ã“ã¨ãŒã»ã¨ã‚“ã©ã§ã™ã€‚ã¨ã„ã†ã“ã¨ã§ä»Šå›ä½œã£ãŸ StreamLoader ã¯ã€è¿½åŠ ãƒ‡ãƒ¼ã‚¿ã‚’é€ã‚‹ã“ã¨ã«ç‰¹åŒ–ã—ã¦ã„ã¾ã™ã€‚å—ã‘å–ã£ãŸãƒ‡ãƒ¼ã‚¿ã‚’ã„ã¤ã‚‚é€šã‚Š state ã¨ã—ã¦å‡¦ç†ã™ã‚Œã°ã€æ™®é€šã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ã„ã¤ã‚‚é€šã‚Šåˆ©ç”¨å‡ºæ¥ã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã‹é¢å€’ãªã“ã¨ã‚’è€ƒãˆãªãã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™ã€‚

ã‚µãƒ¼ãƒå´ã§ä½œæˆã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§å—ã‘å–ã‚‹ãŸã‚ã«ä½¿ã£ã¦ã„ã‚‹ã®ãŒ`useId`ã§ã™ã€‚ã“ã® hook ã®ä½¿ã„é“ã¯ã€SSR æ™‚ã«ã‚µãƒ¼ãƒã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§åŒä¸€ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«å¯¾ã—ã¦åŒä¸€ã® ID ãŒå¿…è¦ãªå ´åˆã§ã™ã€‚æ™®é€šã«ä½¿ã£ã¦ã„ã‚‹åˆ†ã«ã¯ SSR æ™‚ã«é€ä¿¡ã—ãŸ HTML ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ä»®æƒ³ DOM ã‚’åˆã‚ã›ã‚‹ä½œæ¥­ã¯å‹æ‰‹ã«ã‚„ã£ã¦ãã‚Œã‚‹ã®ã§æ„è­˜ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã—ã‹ã—ä»Šå›ã®ã‚ˆã†ã«è‡ªåˆ†ã§å¯¾è±¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è‡ªåˆ†ã§æ¢ã—å‡ºã™å ´åˆã«ä¾¿åˆ©ã«ä½¿ã†ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚

ã¡ãªã¿ã«`<Suspense?`å†…ã« UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œã‚‰ãªã„ã®ã«ã¯ä»–ã«ã‚‚ç†ç”±ãŒã‚ã‚Šã¾ã™ã€‚ãã‚Œã¯å‹•çš„ãª CSS ã®é©ç”¨ãŒé›£ã—ã„ã¨ã„ã†éƒ¨åˆ†ã§ã™ã€‚ã‚°ãƒ­ãƒ¼ãƒãƒ«ãª CSS ã¯å•é¡Œãªã„ã®ã§ã™ãŒã€ã‚¯ãƒ©ã‚¹åãªã©ãŒå‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ã‚¿ã‚¤ãƒ—ã®æ©Ÿèƒ½ã‚’ä½¿ã†ã¨ã€ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãŒå®Œå…¨ã«çµ‚ã‚ã‚‹ã¾ã§ã‚¹ã‚¿ã‚¤ãƒ«ãŒãƒã‚¤ãƒ³ãƒ‰ã•ã‚Œãªã„ã®ã§ã€è¤‡æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã®é€”ä¸­çµŒéãŒæ‚²ã—ã„çŠ¶æ…‹ã¨ãªã‚Šã¾ã™ã€‚

# useSyncExternalStore ã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ãƒ‡ãƒ¼ã‚¿ã‚’é…ã‚‹

useSyncExternalStore ã¯ç‹¬è‡ªã®ã‚¹ãƒ†ãƒ¼ãƒˆç®¡ç†æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã® hook ã§ã™ã€‚ãŸã ã—å®Ÿéš›ã®æ‰€ã€ã“ã® hook ãŒç„¡ãã¦ã‚‚åŒã˜äº‹ã¯å¯èƒ½ã§ã™ã€‚ãªã®ã§ç„¡ç†ã«ä¹—ã‚Šæ›ãˆã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€å…¬å¼æ¨å¥¨ãªã®ã§ãƒ¡ã‚¸ãƒ£ãƒ¼ã©ã“ã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ç§»è¡Œä½œæ¥­ãŒè¡Œã‚ã‚Œã¦ã„ã¾ã™ã€‚

```ts
import { Context, useContext, useRef, useSyncExternalStore } from "react";
// import { useSyncExternalStore } from "use-sync-external-store/shim"; //äº’æ›

export type Store<T = unknown> = {
  dispatches: Set<() => void>;
  value: T;
  setState: (value: T | ((v: T) => T)) => void;
};

export const useStore = <T>(value: T) => {
  const store = useRef<Store<T>>();
  if (!store.current) {
    const setState = (value: T | ((v: T) => T)) => {
      store.current!.value =
        value instanceof Function ? value(store.current!.value) : value;
      store.current!.dispatches.forEach((v) => v());
    };
    store.current = {
      dispatches: new Set<() => void>(),
      value: value,
      setState,
    };
  }
  return { store: store.current };
};

export const useSelector = <T, R>(store: Store<T>, selector: (v: T) => R) =>
  useSyncExternalStore(
    (onStoreChange) => {
      store.dispatches.add(onStoreChange);
      return () => store.dispatches.delete(onStoreChange);
    },
    () => selector(store.value),
    () => selector(store.value)
  );

export const useContextSelector = <T, R>(
  context: Context<Store<T>>,
  selector: (v: T) => R
) => useSelector(useContext(context), selector);

export const useContextDispatch = <T>(context: Context<Store<T>>) =>
  useContext(context).setState;
```

`useStore`ã§çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ store ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã€`useSelector`ã§å¿…è¦ãªã‚‚ã®ã‚’å¼•ã£å¼µã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚selector æ–¹å¼ãªã®ã§ã€ãã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå¿…è¦ã¨ã—ã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’å—ã‘å–ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

- src/pages/index2.tsx

ã“ã¡ã‚‰ãŒä½¿ã„æ–¹ã§ã™ã€‚

```tsx
import { Store, useSelector, useStore } from "./useSyncStore";

type StoreType = { a: number; b: number };

const A = ({ store }: { store: Store<StoreType> }) => {
  const a = useSelector(store, (v) => v.a);
  return <div>A:{a}</div>;
};
const B = ({ store }: { store: Store<StoreType> }) => {
  const b = useSelector(store, (v) => v.b);
  return <div>B:{b}</div>;
};
const Send = ({ store }: { store: Store<StoreType> }) => (
  <div>
    <button
      onClick={() => {
        store.setState((v) => ({ ...v, a: v.a + 1 }));
      }}
    >
      A
    </button>
    <button
      onClick={() => {
        store.setState((v) => ({ ...v, b: v.b + 1 }));
      }}
    >
      B
    </button>
  </div>
);

const Page = () => {
  const { store } = useStore({ a: 1, b: 2 });
  return (
    <div>
      <A store={store} />
      <B store={store} />
      <Send store={store} />
    </div>
  );
};

export default Page;
```

ãƒ‡ãƒ¼ã‚¿ã®æ“ä½œã«ã¯ useStore ã§ä½œã£ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚`store.setState`ã§ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãæ›ãˆã€`useSelector`ã§å€¤ã®å¤‰æ›´ã‚’æ¤œçŸ¥ã—ã¦å¿…è¦ãªå ´æ‰€ã®ã¿å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚

- src/pages/index2.tsx

ContextAPI ä½µç”¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã™ã€‚ä½µç”¨ã¨è¨€ã£ã¦ã‚‚ store ã‚’é…ã£ã¦ã„ã‚‹ã ã‘ã§ã™ã€‚

```tsx
import { createContext } from "react";
import {
  Store,
  useContextDispatch,
  useContextSelector,
  useStore,
} from "./useSyncStore";

type StoreType = { a: number; b: number };

const context = createContext<Store<StoreType>>(undefined as never);

const A = () => {
  const a = useContextSelector(context, (v) => v.a);
  return <div>A:{a}</div>;
};
const B = () => {
  const b = useContextSelector(context, (v) => v.b);
  return <div>B:{b}</div>;
};
const Send = () => {
  const setState = useContextDispatch(context);
  return (
    <div>
      <button
        onClick={() => {
          setState((v) => ({ ...v, a: v.a + 1 }));
        }}
      >
        A
      </button>
      <button
        onClick={() => {
          setState((v) => ({ ...v, b: v.b + 1 }));
        }}
      >
        B
      </button>
    </div>
  );
};

const Page = () => {
  const { store } = useStore({ a: 1, b: 2 });
  return (
    <context.Provider value={store}>
      <A />
      <B />
      <Send />
    </context.Provider>
  );
};

export default Page;
```

ã„ã¡ã„ã¡ store ã‚’é…ã‚‹å¿…è¦ãŒç„¡ããªã‚Šã¾ã—ãŸã€‚ã¡ãªã¿ã« store ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã§ã¯ãªã Context çµŒç”± ã§é…ã£ã¦ã„ã‚‹ç†ç”±ã¯ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¯ SSR å‹•ä½œæ™‚ã«ã‚µãƒ¼ãƒä¸Šã§ä»–äººã«ãƒ‡ãƒ¼ã‚¿æ¼ã‚Œã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã‹ã‚‰ã§ã™ã€‚å…±ç”¨ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã©åˆ†ã‹ã£ã¦ã‚„ã‚‹ã¨ãä»¥å¤–ã¯ãŠã™ã™ã‚ã§ãã¾ã›ã‚“ã€‚

# useDeferredValue ã¨ useTransition ã«ã‚ˆã‚‹ UI ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ãªã„é…å»¶æç”»

æ¯”è¼ƒç”¨ã«`Normal`ã€`useDeferredValue`ã€`useTransition`ã®ä¸‰ã‚¿ã‚¤ãƒ—ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚

```tsx
import {
  ReactNode,
  useDeferredValue,
  useMemo,
  useState,
  useTransition,
} from "react";

const Normal = () => {
  const [value, setValue] = useState("");
  const memo = useMemo(() => {
    return (
      <div>
        {new Array(10000).fill(0).map((_, index) => (
          <div key={index}>{value}</div>
        ))}
      </div>
    );
  }, [value]);
  return (
    <div style={{ width: "200px" }}>
      <div>Normal</div>
      <input value={value} onChange={(e) => setValue(e.target.value)} />
      {memo}
    </div>
  );
};

const Deferred = () => {
  const [value, setValue] = useState("");
  const deferredValue = useDeferredValue(value);
  const memo = useMemo(() => {
    return (
      <div style={{ width: "200px" }}>
        {new Array(10000).fill(0).map((_, index) => (
          <div key={index}>{deferredValue}</div>
        ))}
      </div>
    );
  }, [deferredValue]);
  return (
    <div>
      <div style={{ color: value !== deferredValue ? "gray" : undefined }}>
        Deferred
      </div>
      <input value={value} onChange={(e) => setValue(e.target.value)} />
      {memo}
    </div>
  );
};
const Transition = () => {
  const [isPending, startTransition] = useTransition();
  const [value, setValue] = useState("");
  const [memo, setMemo] = useState<ReactNode>();

  return (
    <div>
      <div style={{ color: isPending ? "gray" : undefined }}>Transition</div>
      <input
        value={value}
        onChange={(e) => {
          setValue(e.target.value);
          startTransition(() => {
            setMemo(
              <div style={{ width: "200px" }}>
                {new Array(10000).fill(0).map((_, index) => (
                  <div key={index}>{e.target.value}</div>
                ))}
              </div>
            );
          });
        }}
      />
      {memo}
    </div>
  );
};
const Page = () => {
  return (
    <>
      <div>
        Source code:{" "}
        <a href="https://github.com/SoraKumo001/next-deferred">
          https://github.com/SoraKumo001/next-deferred
        </a>
      </div>
      <div style={{ display: "flex" }}>
        <Normal />
        <Deferred />
        <Transition />
      </div>
    </>
  );
};

export default Page;
```

3 ã¤ã¨ã‚‚å‡ºæ¥ã‚‹ã ã‘åŒã˜ã‚ˆã†ãªæ„Ÿã˜ã«ã‚³ãƒ¼ãƒ‰ã‚’æƒãˆã¾ã—ãŸã€‚ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã«æ–‡å­—ã‚’å…¥ã‚Œã‚‹ã”ã¨ã«ã€ä¸€ä¸‡è¡Œã»ã©ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãæ›ãˆã¾ã™ã€‚

å®Ÿéš›ã«ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã§ã‚­ãƒ¼ãƒªãƒ”ãƒ¼ãƒˆã‚’ç™ºç”Ÿã•ã›ã‚‹ã¨åˆ†ã‹ã‚Šã¾ã™ãŒã€Normal ã¯ä¸€æ–‡å­—ã”ã¨ã«ä¸€ä¸‡è¡Œæ›¸ãæ›ãˆã‚‹ã®ã§å…¥åŠ›è¡¨ç¤ºãŒé£›ã³ã¾ã™ã€‚ãã‚Œã«å¯¾ã—ã¦ä»–ã®äºŒã¤ã¯ã€ä½™è£•ãŒãªã‘ã‚Œã°ä¸€ä¸‡è¡Œã®éƒ¨åˆ†ã¯æ›¸ãæ›ãˆã‚’è¡Œã‚ãªã„ã®ã§ã€ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã®å†æç”»ã¯æ¯”è¼ƒçš„ã‚¹ãƒ ãƒ¼ã‚ºã«è¡Œãˆã¾ã™ã€‚

ã“ã“ã§ã®é‡è¦ãªç‚¹ã¯ã€ãƒ†ã‚­ã‚¹ãƒˆã®å…¥åŠ›éƒ¨åˆ†ãªã©ã®æ›´æ–°ãŒé…ã‚Œã‚Œã°ã‚¹ãƒˆãƒ¬ã‚¹ãŒæºœã¾ã‚‹éƒ¨åˆ†ã¨ã€å¤šå°‘é…ã‚Œã¦ã‚‚ãã‚Œã»ã©å•é¡Œã®ç„¡ã„çµæœè¡¨ç¤ºã®ã‚ˆã†ãªç®‡æ‰€ã®é¸åˆ¥ã§ã™ã€‚

# ã¾ã¨ã‚

React18 ã®æ–°æ©Ÿèƒ½ã‚’ä¸€é€šã‚Šä½¿ã£ã¦ã¿ã¾ã—ãŸã€‚ãŸã ã—æ–°æ©Ÿèƒ½ã¨è¨€ã£ã¦ã‚‚ SSR-Streaming ä»¥å¤–ã¯æ—§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã‚‚ã»ã¨ã‚“ã©è‡ªå‰ã§å®Ÿè£…ãŒå¯èƒ½ã§ã™ã€‚ãã®ã‹ã‚ã‚Šæ¨™æº–åŒ–ã•ã‚Œã¦å°å…¥ã—ã‚„ã™ãã¯ãªã£ã¦ã„ã‚‹ã®ã§ã€å¿…è¦ã«ãªã£ãŸã¨ãã«å–ã‚Šå…¥ã‚Œã‚‹ã¨è‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
