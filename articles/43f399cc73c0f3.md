---
title: "ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ¢ãƒƒã‚¯ã§Storybookã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã®é–‹ç™ºã‚³ã‚¹ãƒˆã‚’ä¸‹ã’ã‚‹"
emoji: "ğŸ“‘"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [storybook, react, nextjs, mock, jest]
published: true
---

# Storybook ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã®ã‚³ã‚¹ãƒˆã‚’ä¸‹ã’ã‚‹

Storybook ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§å‹•ä½œã‚’ç¢ºèªã—ãªãŒã‚‰ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¿°ã§ãã‚‹ãŸã‚ã€ç”Ÿã® Jest ã‚ˆã‚Šã‚‚é–‹ç™ºãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚ãŸã ã—ã€Storybook ã«ã¯ Jest ã«ã‚ã‚‹é‡è¦ãªæ©Ÿèƒ½ã§ã‚ã‚‹ jest.mock ãŒãªã„ã¨ã„ã†æ¬ ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚jest.mock ã¯ã€ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ãƒ•ãƒƒã‚¯ã—ã¦ã€ç°¡å˜ã«ãƒ¢ãƒƒã‚¯ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã€Storybook ã§ã¯ã“ã®æ©Ÿèƒ½ã¯ä½¿ç”¨ã§ãã¾ã›ã‚“ã€‚ãƒ“ãƒ«ãƒ‰æ™‚ã«ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®å¹²æ¸‰ãŒé˜²æ­¢ã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚

ã“ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«ã€ä»¥ä¸‹ã® Addon ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€jest.mock ã¨åŒã˜ã‚ˆã†ãªæ©Ÿèƒ½ã‚’ Storybook ä¸Šã§åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

![](/images/43f399cc73c0f3/2023-03-20-09-34-54.gif)

## npm

https://www.npmjs.com/package/storybook-addon-module-mock

## ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ 

https://github.com/SoraKumo001/storybook-module-mock

## å‹•ä½œå†…å®¹

https://sorakumo001.github.io/storybook-module-mock/?path=/story/components-formmock--primary

# ãƒ­ã‚°ã‚¤ãƒ³ç”¨ãƒ•ã‚©ãƒ¼ãƒ ã®å‹•ä½œãƒã‚§ãƒƒã‚¯

## FormMock.tsx

ãƒ•ã‚©ãƒ¼ãƒ ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã€ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã§ login ã‚’å‘¼ã³å‡ºã—ã¦ã„ã¾ã™ã€‚

```tsx
import React, { FC } from "react";
import login from "./login";

interface Props {}

/**
 * FormMock
 *
 * @param {Props} { }
 */
export const FormMock: FC<Props> = ({}) => {
  const handleSubmit: React.FormEventHandler<HTMLFormElement> = (e) => {
    e.preventDefault();
    login(e.currentTarget["user"].value, e.currentTarget["password"].value);
  };

  return (
    <div>
      <form onSubmit={handleSubmit}>
        <label>
          User:
          <input type="text" name="user" />
        </label>
        <label>
          Password:
          <input type="password" name="password" />
        </label>
        <button type="submit">Submit</button>
      </form>
    </div>
  );
};
```

## FormMock.stories.tsx

Submit ã‚’ä½¿ç”¨ã—ã¦ãƒ•ã‚©ãƒ¼ãƒ ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€login é–¢æ•°ã®ãƒ¢ãƒƒã‚¯åŒ–ã•ã‚ŒãŸå¼•æ•°ãŒæ­£å¸¸ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ¸¡ã™ã‹ã©ã†ã‹ã‚’ç¢ºèªã—ã¦ã„ã¾ã™ã€‚ã“ã®æ©Ÿèƒ½ã‚’ãƒ¢ãƒƒã‚¯åŒ–ã§ããªã„å ´åˆã€ãƒ†ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹ã“ã¨ã¯éå¸¸ã«å›°é›£ã«ãªã‚Šã¾ã™ã€‚

```tsx
import { expect } from "@storybook/jest";
import { ComponentMeta, ComponentStoryObj } from "@storybook/react";
import { userEvent, within } from "@storybook/testing-library";
import { createMock, getMock } from "storybook-addon-module-mock";
import { FormMock } from "./FormMock";
import * as login from "./login";

const meta: ComponentMeta<typeof FormMock> = {
  title: "Components/FormMock",
  component: FormMock,
};
export default meta;

export const Primary: ComponentStoryObj<typeof FormMock> = {};

export const Submit: ComponentStoryObj<typeof FormMock> = {
  args: {},
  parameters: {
    moduleMock: {
      mock: () => {
        const mock = createMock(login);
        return mock;
      },
    },
  },
  play: async ({ canvasElement, parameters }) => {
    const mock = getMock(parameters, login);

    const canvas = within(canvasElement);
    const userInput = await canvas.findByLabelText("User:");
    const passwordInput = await canvas.findByLabelText("Password:");
    userEvent.type(userInput, "User");
    userEvent.type(passwordInput, "Password");
    userEvent.click(await canvas.findByText("Submit"));
    expect(mock.mock.lastCall).toStrictEqual(["User", "Password"]);
  },
};
```

![](/images/43f399cc73c0f3/2023-03-14-15-34-16.png)

# å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ã‚µãƒãƒ¼ãƒˆ

## FormMock.tsx

getMessage é–¢æ•°ã‹ã‚‰ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—ã—ã€ãã‚Œã‚’è¡¨ç¤ºã™ã‚‹ã ã‘ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚

```tsx
import React, { FC } from "react";
import { getMessage } from "./message";

interface Props {}

/**
 * ReRender
 *
 * @param {Props} { }
 */
export const ReRender: FC<Props> = ({}) => {
  const value = getMessage();
  return <div>{value}</div>;
};
```

## FormMock.stories.tsx

ä»Šå›ã€DOM ã‹ã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆã¯ç™ºç”Ÿã—ã¦ã„ã¾ã›ã‚“ã€‚ä»£ã‚ã‚Šã«ã€getMessage é–¢æ•°ã®æˆ»ã‚Šå€¤ã‚’ç½®ãæ›ãˆã€å¼·åˆ¶çš„ã«å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€è¡¨ç¤ºå†…å®¹ãŒ Test1/Test2 ã«åˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ã€‚ã“ã®æ©Ÿèƒ½ã¯ã€Storybook ã®æ¨™æº–æ©Ÿèƒ½ã«ã¯å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ãŒã€å®Ÿéš›ã«ã¯éå¸¸ã«é‡è¦ã§ã™ã€‚

```tsx
import { expect } from "@storybook/jest";
import { ComponentMeta, ComponentStoryObj } from "@storybook/react";
import { waitFor, within } from "@storybook/testing-library";
import { createMock, getMock, render } from "storybook-addon-module-mock";
import * as message from "./message";
import { ReRender } from "./ReRender";

const meta: ComponentMeta<typeof ReRender> = {
  title: "Components/ReRender",
  component: ReRender,
};
export default meta;

export const Primary: ComponentStoryObj<typeof ReRender> = {};

export const ReRenderTest: ComponentStoryObj<typeof ReRender> = {
  parameters: {
    moduleMock: {
      mock: () => {
        const mock = createMock(message, "getMessage");
        return [mock];
      },
    },
  },
  play: async ({ canvasElement, parameters }) => {
    const canvas = within(canvasElement);
    const mock = getMock(parameters, message, "getMessage");
    mock.mockReturnValue("Test1");
    render(parameters);
    await waitFor(() => {
      expect(canvas.getByText("Test1")).toBeInTheDocument();
    });
    mock.mockReturnValue("Test2");
    render(parameters);
    await waitFor(() => {
      expect(canvas.getByText("Test2")).toBeInTheDocument();
    });
  },
};
```

![](/images/43f399cc73c0f3/2023-03-14-15-34-54.png)

# ã¾ã¨ã‚

ä»Šå›ã€å¿…è¦ãªæ©Ÿèƒ½ã‚’ Addon ã§å®Ÿè£…ã—ã¦ Storybook ã§ãƒ†ã‚¹ãƒˆã‚’è¡Œã„ã¾ã—ãŸã€‚ä»Šå¾Œã‚‚ä½•ã‹å¿…è¦ãªæ©Ÿèƒ½ãŒæ€ã„ã¤ã„ãŸå ´åˆã¯ã€Addon ã«æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã€ã‚ˆã‚Šä¾¿åˆ©ã§åŠ¹ç‡çš„ãªãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ããŸã„ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚
