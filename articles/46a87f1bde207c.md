---
title: "React18.3ã®useã¨Suspenseã®SSRå‹•ä½œã‚’Next.js13ã®`app/ Directory (beta)`ã§ç¢ºèªã™ã‚‹"
emoji: "ğŸŒŠ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [nextjs,react,typescript,javascript]
published: true
---


# Next.jsã®åˆæœŸè¨­å®š

- ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

TypeScriptã‚„@types/nodeã¯è‡ªå‹•ã§å…¥ã‚Šã¾ã™ã€‚  

```bash
yarn add react@next react-dom@next next  
yarn add -D @types/react
```

- next.config.js

```js
// @ts-check
/**
 * @type { import("next").NextConfig}
 */
const config = {
  reactStrictMode: true,
  experimental: {
    appDir: true
  },
};
module.exports = config;
```

ã¡ãªã¿ã«Streaming-SSRã‚’ã™ã‚‹ãŸã‚ã«`runtime: "experimental-edge"`ã®è¨­å®šã¯ä¸è¦ã§ã™ã€‚appãƒ•ã‚©ãƒ«ãƒ€ã®æ©Ÿèƒ½ã‚’ä½¿ã†ã¨è‡ªå‹•çš„ã«StreamingãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™ã€‚

# ã‚µãƒ³ãƒ—ãƒ«ã‚½ãƒ¼ã‚¹

- å®Ÿè¡Œç’°å¢ƒ & Source code link

https://next-layouts-test.vercel.app/

- src/app/page.tsx

å‹•ä½œç¢ºèªç”¨ãƒªãƒ³ã‚¯ã§ã™ã€‚å®Œå…¨ã«ãƒšãƒ¼ã‚¸é·ç§»ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§aã‚¿ã‚°ã§ãƒªãƒ³ã‚¯ã‚’å¼µã£ã¦ã„ã¾ã™ã€‚

```tsx
const Page = () => {
  return (
    <>
      <div><a href="https://github.com/SoraKumo001/next-layouts-test">Source code</a></div>
      <hr />
      <div>
        <a href="/suspense">Suspenseæœ‰ã‚Š</a>
      </div>
      <div>
        <a href="/nosuspense">Suspenseç„¡ã—</a>
      </div>
    </>
  );
};
export default Page;
```

- src/app/suspense/page.tsx

1ç§’ã®ã‚¦ã‚¨ã‚¤ãƒˆãŒå…¥ã£ãŸçŠ¶æ…‹ã§æ±äº¬ã®å¤©æ°—äºˆå ±ã‚’å–å¾—ã—ã¾ã™ã€‚
StreamingãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã®ã§åˆæœŸçŠ¶æ…‹ã§LoadingãŒè¡¨ç¤ºã•ã‚Œã€ãã®å¾Œã€å¤©æ°—äºˆå ±ã«åˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ã€‚

```tsx
import React, { Suspense, use } from "react";

export interface WeatherType {
  publishingOffice: string;
  reportDatetime: string;
  targetArea: string;
  headlineText: string;
  text: string;
}

const fetchWeather = (id: number): Promise<WeatherType> =>
  fetch(`https://www.jma.go.jp/bosai/forecast/data/overview_forecast/${id}.json`)
    .then((r) => r.json())
    .then(
      //ã‚¦ã‚¨ã‚¤ãƒˆè¿½åŠ 
      (r) => new Promise((resolve) => setTimeout(() => resolve(r), 1000))
    );


const Weather = () => {
  //Reactã®æ–°æ©Ÿèƒ½useã§ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã™
  const weather = use(fetchWeather(130000));
  return (
    <div>
      <h1>{weather.targetArea}</h1>
      <div>
        {new Date(weather.reportDatetime).toLocaleString('ja-JP', {
          timeZone: 'JST',
          year: 'numeric',
          month: 'narrow',
          day: 'numeric',
          hour: 'numeric',
          minute: 'numeric',
        })}
      </div>
      <div>{weather.headlineText}</div>
      <pre>{weather.text}</pre>
    </div>
  );
};

const Page = () => {
  return (
    <Suspense fallback='Loading'>
      <Weather />
    </Suspense>
  );
};
export default Page;
```

- src/app/nosuspense/page.tsx

1ç§’ã®ã‚¦ã‚¨ã‚¤ãƒˆãŒå…¥ã£ãŸçŠ¶æ…‹ã§æ±äº¬ã®å¤©æ°—äºˆå ±ã‚’å–å¾—ã—ã¾ã™ã€‚
ã“ã¡ã‚‰ã¯Suspenseã‚’å…¥ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
SuspenseãŒç„¡ã„å ´åˆã¯StreamingãŒè¡Œã‚ã‚Œãšã€ãƒ‡ãƒ¼ã‚¿ãŒå‡ºãã‚ã†ã¾ã§å¾…æ©ŸçŠ¶æ…‹ã«ãªã‚Šã¾ã™ã€‚

```tsx
import React, { Suspense, use } from "react";

export interface WeatherType {
  publishingOffice: string;
  reportDatetime: string;
  targetArea: string;
  headlineText: string;
  text: string;
}

const fetchWeather = (id: number): Promise<WeatherType> =>
  fetch(`https://www.jma.go.jp/bosai/forecast/data/overview_forecast/${id}.json`)
    .then((r) => r.json())
    .then(
      //ã‚¦ã‚¨ã‚¤ãƒˆè¿½åŠ 
      (r) => new Promise((resolve) => setTimeout(() => resolve(r), 1000))
    );


const Weather = () => {
  //Reactã®æ–°æ©Ÿèƒ½useã§ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã™
  const weather = use(fetchWeather(130000));
  return (
    <div>
      <h1>{weather.targetArea}</h1>
      <div>
        {new Date(weather.reportDatetime).toLocaleString('ja-JP', {
          timeZone: 'JST',
          year: 'numeric',
          month: 'narrow',
          day: 'numeric',
          hour: 'numeric',
          minute: 'numeric',
        })}
      </div>
      <div>{weather.headlineText}</div>
      <pre>{weather.text}</pre>
    </div>
  );
};

const Page = () => {
  return (
    <Weather />
  );
};
export default Page;
```

# å‡ºåŠ›HTMLã®é•ã„

## Suspenseæœ‰ã‚Š

Streaming-SSRãŒè¡Œã‚ã‚Œã‚‹ã¨ã€1ã¤ã®ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã§ã€èª­ã¿è¾¼ã¿ä¸­ã®è¡¨ç¤ºã‹ã‚‰çµæœã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã¾ã§ã®å†…å®¹ãŒé€ä¿¡ã§ãã¾ã™ã€‚è¿½åŠ åˆ†ã®å†é…ç½®ã¯JavaScriptãŒè¡Œã„ã¾ã™ã€‚ãã®ãŸã‚ã€JavaScriptã‚’è§£é‡ˆã§ããªã„ç’°å¢ƒã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ã‚‹å ´åˆã«å•é¡ŒãŒç”Ÿã˜ã¾ã™ã€‚SNSã¸ã®ãƒªãƒ³ã‚¯ã®è²¼ã‚Šä»˜ã‘æ™‚ã«OGPã‚’é€ã‚ŠãŸã„å ´åˆãªã©ã§ã™ã€‚

- JavaScriptã‚’åˆ‡ã£ãŸå ´åˆã®è¡¨ç¤ºçµæœ

![](/images/46a87f1bde207c/2022-10-30-15-04-20.png)

- HTMLã®å†…å®¹

`<div hidden id="S:0">`ä»¥é™ã¯ã€JavaScriptãŒå‹•ä½œã—ã¦ã„ãªã„ã¨è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚

```html
<!DOCTYPE html>
<html>
    <head>
        <script src="/_next/static/chunks/polyfills.js" nomodule=""></script>
    </head>
    <body>
        <div>
            <div>
                <!--$?-->
                <template id="B:0"></template>
                Loading
                <!--/$-->
            </div>
        </div>
        <script src="/_next/static/chunks/webpack.js" async=""></script>
        <script src="/_next/static/chunks/main-app.js" async=""></script>
        <script>
            (self.__next_f = self.__next_f || []).push([0])
        </script>
        <script>
            self.__next_f.push([1, "M1:{\"id\":\"./node_modules/next/dist/client/components/app-router.js\",\"name\":\"default\",\"chunks\":[\"app-internals:app-internals\"],\"async\":false}\nM2:{\"id\":\"./node_modules/next/dist/client/components/layout-router.js\",\"name\":\"default\",\"chunks\":[\"app-internals:app-internals\"],\"async\":false}\nM3:{\"id\":\"./node_modules/next/dist/client/components/render-from-template-context.js\",\"name\":\"default\",\"chunks\":[\"app-internals:app-internals\"],\"async\":false}\nS4:\"react.suspense\"\n"])
        </script>
        <script>
            self.__next_f.push([1, "J0:[\"$\",\"@1\",null,{\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/suspense\",\"initialTree\":[\"\",{\"children\":[\"suspense\",{\"children\":[\"\",{}]}]},null,null,true],\"initialHead\":null,\"children\":[[],[],[\"$\",\"html\",null,{\"children\":[[\"$\",\"head\",null,{}],[\"$\",\"body\",null,{\"children\":[\"$\",\"@2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"hasLoading\":false,\"template\":[\"$\",\"@3\",null,{}],\"notFound\":[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"-apple-system, BlinkMacSystemFont, Roboto, \\\"Segoe UI\\\", \\\"Fira Sans\\\", Avenir, \\\"Helvetica Neue\\\", \\\"Lucida Grande\\\", sans-serif\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[[\"$\",\"head\",null,{\"children\":[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\\n            body { margin: 0; color: #000; background: #fff; }\\n            .next-error-h1 {\\n              border-right: 1px solid rgba(0, 0, 0, .3);\\n            }\\n\\n            @media (prefers-color-scheme: dark) {\\n              body { color: #fff; background: #000; }\\n              .next-error-h1 {\\n                border-right: 1px solid rgba(255, 255, 255, .3);\\n              }\\n            }\\n          \"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":0,\"marginRight\":\"20px\",\"padding\":\"0 23px 0 0\",\"fontSize\":\"24px\",\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\",\"textAlign\":\"left\",\"lineHeight\":\"49px\",\"height\":\"49px\",\"verticalAlign\":\"middle\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":\"14px\",\"fontWeight\":\"normal\",\"lineHeight\":\"49px\",\"margin\":0,\"padding\":0},\"children\":\"This page could not be found.\"}]}]]}]]}],\"childProp\":{\"current\":[\"$\",\"@2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"suspense\",\"children\"],\"hasLoading\":false,\"template\":[\"$\",\"@3\",null,{}],\"childProp\":{\"current\":[[],[],[\"$\",\"$4\",null,{\"fallback\":\"Loading\",\"children\":\"@5\"}]],\"segment\":\"\"},\"rootLayoutIncluded\":true}],\"segment\":\"suspense\"},\"rootLayoutIncluded\":true}]}]]}]]}]\n"])
        </script>
        <script>
            self.__next_f.push([1, "J5:[\"$\",\"div\",null,{\"children\":[[\"$\",\"h1\",null,{\"children\":\"æ±äº¬éƒ½\"}],[\"$\",\"div\",null,{\"children\":\"2022å¹´10æœˆ30æ—¥ 10:36\"}],[\"$\",\"div\",null,{\"children\":\"\"}],[\"$\",\"pre\",null,{\"children\":\"ã€€æœ¬å·ä»˜è¿‘ã¯ã€å¤§é™¸ã«ä¸­å¿ƒã‚’æŒã¤é«˜æ°—åœ§ã«è¦†ã‚ã‚Œã¦ã„ã¾ã™ãŒã€æ°—åœ§ã®è°·ã‚„æ¹¿ã£ãŸç©ºæ°—ã®å½±éŸ¿ã‚’å—ã‘ã¦ã„ã¾ã™ã€‚\\n\\nã€€æ±äº¬åœ°æ–¹ã¯ã€ãŠãŠã‚€ã­æ™´ã‚Œã¨ãªã£ã¦ã„ã¾ã™ã€‚\\n\\nã€€ï¼“ï¼æ—¥ã¯ã€é«˜æ°—åœ§ã«è¦†ã‚ã‚Œã¾ã™ãŒã€æ°—åœ§ã®è°·ã‚„æ¹¿ã£ãŸç©ºæ°—ã®å½±éŸ¿ã‚’å—ã‘ã‚‹è¦‹è¾¼ã¿ã§ã™ã€‚ã“ã®ãŸã‚ã€æ™´ã‚Œæ™‚ã€…æ›‡ã‚Šã¨ãªã‚‹ã§ã—ã‚‡ã†ã€‚\\n\\nã€€ï¼“ï¼‘æ—¥ã¯ã€é«˜æ°—åœ§ã«è¦†ã‚ã‚Œã¾ã™ãŒã€æ°—åœ§ã®è°·ã‚„æ¹¿ã£ãŸç©ºæ°—ã®å½±éŸ¿ã‚’å—ã‘ã‚‹è¦‹è¾¼ã¿ã§ã™ã€‚ã“ã®ãŸã‚ã€æ™´ã‚Œã§æœæ™©ã¯æ›‡ã‚Šã¨ãªã‚‹ã§ã—ã‚‡ã†ã€‚\\n\\nã€é–¢æ±ç”²ä¿¡åœ°æ–¹ã€‘\\nã€€é–¢æ±ç”²ä¿¡åœ°æ–¹ã¯ã€æ™´ã‚Œã‚„æ›‡ã‚Šã¨ãªã£ã¦ã„ã¾ã™ã€‚\\n\\nã€€ï¼“ï¼æ—¥ã¯ã€é«˜æ°—åœ§ã«è¦†ã‚ã‚Œã¾ã™ãŒã€æ°—åœ§ã®è°·ã‚„æ¹¿ã£ãŸç©ºæ°—ã®å½±éŸ¿ã‚’å—ã‘ã‚‹è¦‹è¾¼ã¿ã§ã™ã€‚ã“ã®ãŸã‚ã€æ™´ã‚Œã‚„æ›‡ã‚Šã§ã—ã‚‡ã†ã€‚\\n\\nã€€ï¼“ï¼‘æ—¥ã¯ã€é«˜æ°—åœ§ã«è¦†ã‚ã‚Œã¾ã™ãŒã€æ°—åœ§ã®è°·ã‚„æ¹¿ã£ãŸç©ºæ°—ã®å½±éŸ¿ã‚’å—ã‘ã‚‹è¦‹è¾¼ã¿ã§ã™ã€‚ã“ã®ãŸã‚ã€æ™´ã‚Œã‚„æ›‡ã‚Šã§ã—ã‚‡ã†ã€‚\\n\\nã€€é–¢æ±åœ°æ–¹ã¨ä¼Šè±†è«¸å³¶ã®æµ·ä¸Šã§ã¯ã€ã†ã­ã‚Šã‚’ä¼´ã„ã€ï¼“ï¼æ—¥ã¯æ³¢ãŒé«˜ãã€ï¼“ï¼‘æ—¥ã¯æ³¢ãŒã‚„ã‚„é«˜ã„è¦‹è¾¼ã¿ã§ã™ã€‚èˆ¹èˆ¶ã¯é«˜æ³¢ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚\"}]]}]\n"])
        </script>
        <div hidden id="S:0">
            <div>
                <h1>æ±äº¬éƒ½</h1>
                <div>2022å¹´10æœˆ30æ—¥ 10:36</div>
                <div></div>
                <pre>æœ¬å·ä»˜è¿‘ã¯ã€å¤§é™¸ã«ä¸­å¿ƒã‚’æŒã¤é«˜æ°—åœ§ã«è¦†ã‚ã‚Œã¦ã„ã¾ã™ãŒã€æ°—åœ§ã®è°·ã‚„æ¹¿ã£ãŸç©ºæ°—ã®å½±éŸ¿ã‚’å—ã‘ã¦ã„ã¾ã™ã€‚

ã€€æ±äº¬åœ°æ–¹ã¯ã€ãŠãŠã‚€ã­æ™´ã‚Œã¨ãªã£ã¦ã„ã¾ã™ã€‚

ã€€ï¼“ï¼æ—¥ã¯ã€é«˜æ°—åœ§ã«è¦†ã‚ã‚Œã¾ã™ãŒã€æ°—åœ§ã®è°·ã‚„æ¹¿ã£ãŸç©ºæ°—ã®å½±éŸ¿ã‚’å—ã‘ã‚‹è¦‹è¾¼ã¿ã§ã™ã€‚ã“ã®ãŸã‚ã€æ™´ã‚Œæ™‚ã€…æ›‡ã‚Šã¨ãªã‚‹ã§ã—ã‚‡ã†ã€‚

ã€€ï¼“ï¼‘æ—¥ã¯ã€é«˜æ°—åœ§ã«è¦†ã‚ã‚Œã¾ã™ãŒã€æ°—åœ§ã®è°·ã‚„æ¹¿ã£ãŸç©ºæ°—ã®å½±éŸ¿ã‚’å—ã‘ã‚‹è¦‹è¾¼ã¿ã§ã™ã€‚ã“ã®ãŸã‚ã€æ™´ã‚Œã§æœæ™©ã¯æ›‡ã‚Šã¨ãªã‚‹ã§ã—ã‚‡ã†ã€‚

ã€é–¢æ±ç”²ä¿¡åœ°æ–¹ã€‘
ã€€é–¢æ±ç”²ä¿¡åœ°æ–¹ã¯ã€æ™´ã‚Œã‚„æ›‡ã‚Šã¨ãªã£ã¦ã„ã¾ã™ã€‚

ã€€ï¼“ï¼æ—¥ã¯ã€é«˜æ°—åœ§ã«è¦†ã‚ã‚Œã¾ã™ãŒã€æ°—åœ§ã®è°·ã‚„æ¹¿ã£ãŸç©ºæ°—ã®å½±éŸ¿ã‚’å—ã‘ã‚‹è¦‹è¾¼ã¿ã§ã™ã€‚ã“ã®ãŸã‚ã€æ™´ã‚Œã‚„æ›‡ã‚Šã§ã—ã‚‡ã†ã€‚

ã€€ï¼“ï¼‘æ—¥ã¯ã€é«˜æ°—åœ§ã«è¦†ã‚ã‚Œã¾ã™ãŒã€æ°—åœ§ã®è°·ã‚„æ¹¿ã£ãŸç©ºæ°—ã®å½±éŸ¿ã‚’å—ã‘ã‚‹è¦‹è¾¼ã¿ã§ã™ã€‚ã“ã®ãŸã‚ã€æ™´ã‚Œã‚„æ›‡ã‚Šã§ã—ã‚‡ã†ã€‚

ã€€é–¢æ±åœ°æ–¹ã¨ä¼Šè±†è«¸å³¶ã®æµ·ä¸Šã§ã¯ã€ã†ã­ã‚Šã‚’ä¼´ã„ã€ï¼“ï¼æ—¥ã¯æ³¢ãŒé«˜ãã€ï¼“ï¼‘æ—¥ã¯æ³¢ãŒã‚„ã‚„é«˜ã„è¦‹è¾¼ã¿ã§ã™ã€‚èˆ¹èˆ¶ã¯é«˜æ³¢ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚</pre>
            </div>
        </div>
        <script>
            $RC = function(b, c, e) {
                c = document.getElementById(c);
                c.parentNode.removeChild(c);
                var a = document.getElementById(b);
                if (a) {
                    b = a.previousSibling;
                    if (e)
                        b.data = "$!",
                        a.setAttribute("data-dgst", e);
                    else {
                        e = b.parentNode;
                        a = b.nextSibling;
                        var f = 0;
                        do {
                            if (a && 8 === a.nodeType) {
                                var d = a.data;
                                if ("/$" === d)
                                    if (0 === f)
                                        break;
                                    else
                                        f--;
                                else
                                    "$" !== d && "$?" !== d && "$!" !== d || f++
                            }
                            d = a.nextSibling;
                            e.removeChild(a);
                            a = d
                        } while (a);
                        for (; c.firstChild; )
                            e.insertBefore(c.firstChild, a);
                        b.data = "$"
                    }
                    b._reactRetry && b._reactRetry()
                }
            }
            ;
            ;$RC("B:0", "S:0")
        </script>
    </body>
</html>
```



## Suspenseç„¡ã—

Suspenseã‚’ä½¿ã‚ãªã‹ã£ãŸå ´åˆã¯ã€ãƒ‡ãƒ¼ã‚¿ãŒå‡ºãã‚ã£ãŸçŠ¶æ…‹ã®HTMLãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚ã‚‚ã†å°‘ã—æ­£ç¢ºã«è¨€ã†ã¨ã€useã‚„throwã§æœªè§£æ±ºã®promiseãŒå…¨ã¦è§£æ±ºã•ã‚Œã‚‹ã¾ã§å¾…æ©ŸçŠ¶æ…‹ã«ãªã‚Šã¾ã™ã€‚ã©ã“ã‹ã—ã‚‰ã«Suspenseã§å›²ã‚ã‚Œã¦ã„ãªã„throwãŒä¸€ç®‡æ‰€ã§ã‚‚æŠ•ã’ã‚‰ã‚Œã¦ã„ã‚Œã°ã€ãã“ã§ä¸€æ™‚åœæ­¢ã¨ãªã‚Šã¾ã™ã€‚

- JavaScriptã‚’åˆ‡ã£ãŸå ´åˆã®è¡¨ç¤ºçµæœ

![](/images/46a87f1bde207c/2022-10-30-15-03-52.png)

- HTMLã®å†…å®¹

```html
<!DOCTYPE html>
<html>
    <head>
        <script src="/_next/static/chunks/polyfills.js" nomodule=""></script>
    </head>
    <body>
        <div>
            <div>
                <div>
                    <h1>æ±äº¬éƒ½</h1>
                    <div>2022å¹´10æœˆ30æ—¥ 10:36</div>
                    <div></div>
                    <pre>æœ¬å·ä»˜è¿‘ã¯ã€å¤§é™¸ã«ä¸­å¿ƒã‚’æŒã¤é«˜æ°—åœ§ã«è¦†ã‚ã‚Œã¦ã„ã¾ã™ãŒã€æ°—åœ§ã®è°·ã‚„æ¹¿ã£ãŸç©ºæ°—ã®å½±éŸ¿ã‚’å—ã‘ã¦ã„ã¾ã™ã€‚

ã€€æ±äº¬åœ°æ–¹ã¯ã€ãŠãŠã‚€ã­æ™´ã‚Œã¨ãªã£ã¦ã„ã¾ã™ã€‚

ã€€ï¼“ï¼æ—¥ã¯ã€é«˜æ°—åœ§ã«è¦†ã‚ã‚Œã¾ã™ãŒã€æ°—åœ§ã®è°·ã‚„æ¹¿ã£ãŸç©ºæ°—ã®å½±éŸ¿ã‚’å—ã‘ã‚‹è¦‹è¾¼ã¿ã§ã™ã€‚ã“ã®ãŸã‚ã€æ™´ã‚Œæ™‚ã€…æ›‡ã‚Šã¨ãªã‚‹ã§ã—ã‚‡ã†ã€‚

ã€€ï¼“ï¼‘æ—¥ã¯ã€é«˜æ°—åœ§ã«è¦†ã‚ã‚Œã¾ã™ãŒã€æ°—åœ§ã®è°·ã‚„æ¹¿ã£ãŸç©ºæ°—ã®å½±éŸ¿ã‚’å—ã‘ã‚‹è¦‹è¾¼ã¿ã§ã™ã€‚ã“ã®ãŸã‚ã€æ™´ã‚Œã§æœæ™©ã¯æ›‡ã‚Šã¨ãªã‚‹ã§ã—ã‚‡ã†ã€‚

ã€é–¢æ±ç”²ä¿¡åœ°æ–¹ã€‘
ã€€é–¢æ±ç”²ä¿¡åœ°æ–¹ã¯ã€æ™´ã‚Œã‚„æ›‡ã‚Šã¨ãªã£ã¦ã„ã¾ã™ã€‚

ã€€ï¼“ï¼æ—¥ã¯ã€é«˜æ°—åœ§ã«è¦†ã‚ã‚Œã¾ã™ãŒã€æ°—åœ§ã®è°·ã‚„æ¹¿ã£ãŸç©ºæ°—ã®å½±éŸ¿ã‚’å—ã‘ã‚‹è¦‹è¾¼ã¿ã§ã™ã€‚ã“ã®ãŸã‚ã€æ™´ã‚Œã‚„æ›‡ã‚Šã§ã—ã‚‡ã†ã€‚

ã€€ï¼“ï¼‘æ—¥ã¯ã€é«˜æ°—åœ§ã«è¦†ã‚ã‚Œã¾ã™ãŒã€æ°—åœ§ã®è°·ã‚„æ¹¿ã£ãŸç©ºæ°—ã®å½±éŸ¿ã‚’å—ã‘ã‚‹è¦‹è¾¼ã¿ã§ã™ã€‚ã“ã®ãŸã‚ã€æ™´ã‚Œã‚„æ›‡ã‚Šã§ã—ã‚‡ã†ã€‚

ã€€é–¢æ±åœ°æ–¹ã¨ä¼Šè±†è«¸å³¶ã®æµ·ä¸Šã§ã¯ã€ã†ã­ã‚Šã‚’ä¼´ã„ã€ï¼“ï¼æ—¥ã¯æ³¢ãŒé«˜ãã€ï¼“ï¼‘æ—¥ã¯æ³¢ãŒã‚„ã‚„é«˜ã„è¦‹è¾¼ã¿ã§ã™ã€‚èˆ¹èˆ¶ã¯é«˜æ³¢ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚</pre>
                </div>
            </div>
        </div>
        <script src="/_next/static/chunks/webpack.js" async=""></script>
        <script src="/_next/static/chunks/main-app.js" async=""></script>
    </body>
</html>
<script>
    (self.__next_f = self.__next_f || []).push([0])
</script>
<script>
    self.__next_f.push([1, "M1:{\"id\":\"./node_modules/next/dist/client/components/app-router.js\",\"name\":\"default\",\"chunks\":[\"app-internals:app-internals\"],\"async\":false}\nM2:{\"id\":\"./node_modules/next/dist/client/components/layout-router.js\",\"name\":\"default\",\"chunks\":[\"app-internals:app-internals\"],\"async\":false}\nM3:{\"id\":\"./node_modules/next/dist/client/components/render-from-template-context.js\",\"name\":\"default\",\"chunks\":[\"app-internals:app-internals\"],\"async\":false}\n"])
</script>
<script>
    self.__next_f.push([1, "J0:[\"$\",\"@1\",null,{\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/nosuspense\",\"initialTree\":[\"\",{\"children\":[\"nosuspense\",{\"children\":[\"\",{}]}]},null,null,true],\"initialHead\":null,\"children\":[[],[],[\"$\",\"html\",null,{\"children\":[[\"$\",\"head\",null,{}],[\"$\",\"body\",null,{\"children\":[\"$\",\"@2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"hasLoading\":false,\"template\":[\"$\",\"@3\",null,{}],\"notFound\":[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"-apple-system, BlinkMacSystemFont, Roboto, \\\"Segoe UI\\\", \\\"Fira Sans\\\", Avenir, \\\"Helvetica Neue\\\", \\\"Lucida Grande\\\", sans-serif\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[[\"$\",\"head\",null,{\"children\":[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\\n            body { margin: 0; color: #000; background: #fff; }\\n            .next-error-h1 {\\n              border-right: 1px solid rgba(0, 0, 0, .3);\\n            }\\n\\n            @media (prefers-color-scheme: dark) {\\n              body { color: #fff; background: #000; }\\n              .next-error-h1 {\\n                border-right: 1px solid rgba(255, 255, 255, .3);\\n              }\\n            }\\n          \"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":0,\"marginRight\":\"20px\",\"padding\":\"0 23px 0 0\",\"fontSize\":\"24px\",\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\",\"textAlign\":\"left\",\"lineHeight\":\"49px\",\"height\":\"49px\",\"verticalAlign\":\"middle\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":\"14px\",\"fontWeight\":\"normal\",\"lineHeight\":\"49px\",\"margin\":0,\"padding\":0},\"children\":\"This page could not be found.\"}]}]]}]]}],\"childProp\":{\"current\":[\"$\",\"@2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"nosuspense\",\"children\"],\"hasLoading\":false,\"template\":[\"$\",\"@3\",null,{}],\"childProp\":{\"current\":[[],[],\"@4\"],\"segment\":\"\"},\"rootLayoutIncluded\":true}],\"segment\":\"nosuspense\"},\"rootLayoutIncluded\":true}]}]]}]]}]\n"])
</script>
<script>
    self.__next_f.push([1, "J4:[\"$\",\"div\",null,{\"children\":[[\"$\",\"h1\",null,{\"children\":\"æ±äº¬éƒ½\"}],[\"$\",\"div\",null,{\"children\":\"2022å¹´10æœˆ30æ—¥ 10:36\"}],[\"$\",\"div\",null,{\"children\":\"\"}],[\"$\",\"pre\",null,{\"children\":\"ã€€æœ¬å·ä»˜è¿‘ã¯ã€å¤§é™¸ã«ä¸­å¿ƒã‚’æŒã¤é«˜æ°—åœ§ã«è¦†ã‚ã‚Œã¦ã„ã¾ã™ãŒã€æ°—åœ§ã®è°·ã‚„æ¹¿ã£ãŸç©ºæ°—ã®å½±éŸ¿ã‚’å—ã‘ã¦ã„ã¾ã™ã€‚\\n\\nã€€æ±äº¬åœ°æ–¹ã¯ã€ãŠãŠã‚€ã­æ™´ã‚Œã¨ãªã£ã¦ã„ã¾ã™ã€‚\\n\\nã€€ï¼“ï¼æ—¥ã¯ã€é«˜æ°—åœ§ã«è¦†ã‚ã‚Œã¾ã™ãŒã€æ°—åœ§ã®è°·ã‚„æ¹¿ã£ãŸç©ºæ°—ã®å½±éŸ¿ã‚’å—ã‘ã‚‹è¦‹è¾¼ã¿ã§ã™ã€‚ã“ã®ãŸã‚ã€æ™´ã‚Œæ™‚ã€…æ›‡ã‚Šã¨ãªã‚‹ã§ã—ã‚‡ã†ã€‚\\n\\nã€€ï¼“ï¼‘æ—¥ã¯ã€é«˜æ°—åœ§ã«è¦†ã‚ã‚Œã¾ã™ãŒã€æ°—åœ§ã®è°·ã‚„æ¹¿ã£ãŸç©ºæ°—ã®å½±éŸ¿ã‚’å—ã‘ã‚‹è¦‹è¾¼ã¿ã§ã™ã€‚ã“ã®ãŸã‚ã€æ™´ã‚Œã§æœæ™©ã¯æ›‡ã‚Šã¨ãªã‚‹ã§ã—ã‚‡ã†ã€‚\\n\\nã€é–¢æ±ç”²ä¿¡åœ°æ–¹ã€‘\\nã€€é–¢æ±ç”²ä¿¡åœ°æ–¹ã¯ã€æ™´ã‚Œã‚„æ›‡ã‚Šã¨ãªã£ã¦ã„ã¾ã™ã€‚\\n\\nã€€ï¼“ï¼æ—¥ã¯ã€é«˜æ°—åœ§ã«è¦†ã‚ã‚Œã¾ã™ãŒã€æ°—åœ§ã®è°·ã‚„æ¹¿ã£ãŸç©ºæ°—ã®å½±éŸ¿ã‚’å—ã‘ã‚‹è¦‹è¾¼ã¿ã§ã™ã€‚ã“ã®ãŸã‚ã€æ™´ã‚Œã‚„æ›‡ã‚Šã§ã—ã‚‡ã†ã€‚\\n\\nã€€ï¼“ï¼‘æ—¥ã¯ã€é«˜æ°—åœ§ã«è¦†ã‚ã‚Œã¾ã™ãŒã€æ°—åœ§ã®è°·ã‚„æ¹¿ã£ãŸç©ºæ°—ã®å½±éŸ¿ã‚’å—ã‘ã‚‹è¦‹è¾¼ã¿ã§ã™ã€‚ã“ã®ãŸã‚ã€æ™´ã‚Œã‚„æ›‡ã‚Šã§ã—ã‚‡ã†ã€‚\\n\\nã€€é–¢æ±åœ°æ–¹ã¨ä¼Šè±†è«¸å³¶ã®æµ·ä¸Šã§ã¯ã€ã†ã­ã‚Šã‚’ä¼´ã„ã€ï¼“ï¼æ—¥ã¯æ³¢ãŒé«˜ãã€ï¼“ï¼‘æ—¥ã¯æ³¢ãŒã‚„ã‚„é«˜ã„è¦‹è¾¼ã¿ã§ã™ã€‚èˆ¹èˆ¶ã¯é«˜æ³¢ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚\"}]]}]\n"])
</script>
```

# ã¾ã¨ã‚

ä»Šå›ã¯Next.jsã®Suspenseã«ã‚ˆã‚‹æŒ™å‹•ã®é•ã„ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚ãã®éš›ã«Next.jsã®13ã§åŠ ã‚ã£ãŸ`app/ Directory (beta)`ã‚’ä½¿ç”¨ã—ã¾ã—ãŸãŒã€å¾“æ¥ã®`pages`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå ´åˆã‚‚åŒã˜æŒ™å‹•ã‚’ã—ã¾ã™ã€‚ãŸã ã€ServerComponetsã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã®è«¸ã€…ã®å‡¦ç†ã‚’æ›¸ã‹ãªãã¦è‰¯ã„ã®ã§è§£èª¬ç”¨ã«åˆ©ç”¨ã—ã¾ã—ãŸã€‚

`app/ Directory (beta)`ã§ã¯ã€ä»Šå›ã®ã‚ˆã†ã«Streaming-SSRãŒç°¡å˜ã«è¡Œãˆã¾ã™ã€‚ãŸã ã—æ³¨æ„ç‚¹ã¯ServerComponentsãŒå‰æã¨ãªã£ã¦ã„ã‚‹ã“ã¨ã§ã™ã€‚ServerComponentsã¯ã‚¹ãƒ†ãƒ¼ãƒˆã‚’ä½œã‚Œãšã€è‡ªç”±ãªçŠ¶æ…‹å¤‰åŒ–ã‚’ä½¿ã†ã“ã¨ãŒå‡ºæ¥ã¾ã›ã‚“ã€‚ã‹ãªã‚Šä½¿ã„å›ã—ãŒé›£ã—ããªã‚Šã¾ã™ã€‚ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ç¯„å›²ã‚’è¶…ãˆã¦ã¾ã¨ã‚‚ã«å®Ÿè£…ã—ã¦ã„ãã¨ã€ã‹ãªã‚Šè‹¦åŠ´ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

ã¡ãªã¿ã«ã€`app/ Directory (beta)`ã‚„ServerComponentsã‚’åˆ©ç”¨ã›ãšã€use+Suspenseã‚’ä½¿ã£ã¦ã„ã¦ã‚‚å®Œæˆç‰ˆã®HTMLã‚’å‡ºåŠ›ã™ã‚‹è¨˜äº‹ã‚‚æ›¸ãã¾ã—ãŸã€‚

https://next-blog.croud.jp/contents/zRYIDSBtrEwtfIsg1nCS

ServerComponentsã‚’ä½¿ã£ã¦ã„ãªã„ã®ã§ã€å¾“æ¥é€šã‚Šã‚¹ãƒ†ãƒ¼ãƒˆã‚‚ä½¿ãˆã¾ã™ã€‚é¢å€’ãã•ã„åˆ¶ç´„ã¯ç‰¹ã«ã‚ã‚Šã¾ã›ã‚“ã€‚
