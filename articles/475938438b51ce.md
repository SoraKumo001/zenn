---
title: "[TypeScript]OpenAPIv3ã®å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã€å…¥åŠ›è£œå®Œã‚’ãƒãƒƒãƒãƒªåŠ¹ã‹ã›ã¦é–‹ç™ºã™ã‚‹"
emoji: "ğŸ“Œ"
type: "tech"
topics: ["nodejs", "typescript", "swagger", "restapi", "openapi"]
published: true
---

# TypeScriptã®å…¥åŠ›è£œå®Œ

TypeScriptã¯VSCodeã®ã‚ˆã†ãªé–‹ç™ºç’°å¢ƒã‚’ä½¿ã†ã¨ã€æ§˜ã€…ãªç‰©ãŒå…¥åŠ›è£œå®Œã§å€™è£œã‚’çµã‚Šè¾¼ã‚ã¾ã™ã€‚ã“ã®æ©Ÿèƒ½ãŒã‚ã‚‹ã‹ãªã„ã‹ã§é–‹ç™ºåŠ¹ç‡ã«æ®µé•ã„ãªå·®ãŒå‡ºã¦ãã¾ã™ã€‚ãã†ãªã£ã¦ãã‚‹ã¨ã‚ã‚‰ã‚†ã‚‹ç‰©ã‚’è£œå®Œã®å¯¾è±¡ã«ã—ãŸããªã‚‹ã®ã¯äººæƒ…ã§ã—ã‚‡ã†ã€‚ä»Šå›ã¯OpenAPIv3ã®å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…ƒã«ã€RestAPIã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è£œå®Œã—ã¾ãã‚Šã¾ã™ã€‚

# OpenAPI(Swagger)ã®åˆ©ç‚¹

OpenAPIã§RestAPIã®å®šç¾©ã‚’ä½œã£ã¦ãŠãã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªåˆ©ç‚¹ã‚’å¾—ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚

- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ãƒãƒ¼ãƒ ã§å…±æœ‰
- ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒã®ç«‹ã¡ä¸Šã’
- å„è¨€èªã®å‹æƒ…å ±ã‚’ç”Ÿæˆ

ä»Šå›ã¯TypeScriptã‚’ä½¿ç”¨ã—ã¾ã™ãŒã€å…±é€šä»•æ§˜ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãªã®ã§è¨€èªã‚’é¸ã³ã¾ã›ã‚“ã€‚

# TypeScriptã§ã®æ´»ç”¨æ–¹æ³•

OpenAPIã®å®šç¾©æƒ…å ±ã‹ã‚‰TypeScriptã®å‹ã‚’ç”Ÿæˆã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ã„ãã¤ã‹ç”¨æ„ã•ã‚Œã¦ãŠã‚Šã€ãã‚Œã‚‰ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§RestAPIå…¥å‡ºåŠ›ã®ãŸã‚ã®å‹æƒ…å ±ã‚’æ‰‹å‹•ã§æ›¸ãã¨ã„ã†çŠ¶æ³ã‚’ã‚ã‚‹ç¨‹åº¦å›é¿ã§ãã¾ã™ã€‚

ä»Šå›ã¯openapi-typescriptã¨ã„ã†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åˆ©ç”¨ã—ã¦å‹æƒ…å ±ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

# ä»Šå›ä½¿ç”¨ã—ã¦ã„ã‚‹ä¸»ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

- [openapi-typescript](https://www.npmjs.com/package/openapi-typescript)  
OpenAPIã®å®šç¾©æƒ…å ±ã‚’TypeScriptã§åˆ©ç”¨å‡ºæ¥ã‚‹å½¢ã«å¤‰æ›ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
- [request-restapi](https://www.npmjs.com/package/request-restapi)  
openapi-typescriptã§å‡ºåŠ›ã—ãŸTypeScriptã®å‹æƒ…å ±ã‚’åˆ©ç”¨ã—ã¦ã€RestAPIã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸(è‡ªå‰ã§ä½œæˆã—ã¾ã—ãŸ)

# å‹æƒ…å ±ã®å–å¾—ã®ä»•æ–¹

ã‚µãƒ³ãƒ—ãƒ«ç”¨ã«GitHubã®OpenAPIå®šç¾©æƒ…å ±ã‚’TypeScriptã®å®šç¾©ã«å¤‰æ›ã—ã¾ã™

`npx openapi-typescript https://raw.githubusercontent.com/github/rest-api-description/main/descriptions/ghes-3.0/ghes-3.0.yaml > github.d.ts`

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã§`github.d.ts`ã«TypeScriptç”¨ã®å‹æƒ…å ±ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã€å®šç¾©æƒ…å ±ã ã‘ã§1.2MBã‚‚ã‚ã‚Šã¾ã™ã€‚ã‚µãƒ³ãƒ—ãƒ«ã§ã¯ã“ã‚Œã‚’åˆ©ç”¨ã—ã¦TypeScriptã§ã®å…¥åŠ›è£œå®Œã‚’æ¤œè¨¼ã—ã¾ã™ã€‚

# ãƒ—ãƒ­ã‚°ãƒ©ãƒ 

GitHubã®RestAPIã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚
<https://github.com/SoraKumo001/request-restapi-test>

èªè¨¼ç”¨ã®TokenãŒå¿…è¦ã«ãªã‚‹ã®ã§ã€äº‹å‰ã«<https://github.com/settings/tokens>ã§ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½œæˆã—ã€`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã«`TOKEN=GITHUBã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³`ã‚’å…¥ã‚Œã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä½œæˆã™ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã«ã¯ä¸€åˆ‡æ¨©é™ã¯ä»˜ã‘ãªãã¦ã‹ã¾ã„ã¾ã›ã‚“ã€‚

```ts
import { Rest } from "request-restapi";
import { paths } from "./github";
import env from "dotenv";

env.config();
const token = process.env.TOKEN;
const rest = new Rest<paths>({ baseUrl: "https://api.github.com", token });

//Display user name
(async () => {
  const resultUser = await rest.request({
    path: "/user",
    method: "get",
  });
  // codeã‚’è­˜åˆ¥ã—ãŸæ™‚ç‚¹ã§bodyãŒç¢ºå®šã™ã‚‹
  if (resultUser.code === 200) {
    const { body } = resultUser;
    console.log(`UserName: ${body.name}`);
  } else {
    console.error(resultUser);
  }
  console.log("---------");

  // View repository list
  for (let page = 1; page < 100; page++) {
    const result = await rest.request({
      path: "/user/repos",
      method: "get",
      query: { page },
    });
    if (result.code === 200) {
      const { body } = result;
      if (body.length === 0) break;
      body.forEach((value) => {
        console.log(value.name);
      });
    } else {
      console.error(result);
      break;
    }
  }
  console.log("---------");

  // View specific repository information
  const resultRepo = await rest.request({
    path: "/repos/{owner}/{repo}",
    params: { owner: "SoraKumo001", repo: "request-restapi" },
    method: "get",
  });
  if (resultRepo.code === 200) {
    const { body, headers } = resultRepo;
    console.log(body);
    console.log(headers);
  } else {
    console.error(resultRepo);
  }
})();
```

# å…¨éƒ¨è£œå®Œã•ã‚Œã‚‹

ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã ã‘è¦‹ã‚‹ã¨ã€RestAPIã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ©Ÿèƒ½ã‚’æä¾›ã—ã¦ã„ã‚‹ã ã‘ã«è¦‹ãˆã¾ã™ã€‚ä¸€èˆ¬çš„ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨é•ã†ã®ã¯ã€request-restapiã«ã‚ˆã£ã¦å‹æƒ…å ±ãŒã‚¬ãƒƒãƒã‚¬ãƒã«å›ºã‚ã‚‰ã‚Œã¦ã„ã‚‹ã“ã¨ã§ã™ã€‚

- ãƒ‘ã‚¹ã®å…¥åŠ›è£œå®Œ
![](https://storage.googleapis.com/zenn-user-upload/qeqyrq42i6jttrwzrgxb0p3ng7yl)

- ãƒ‘ã‚¹æ±ºå®šå¾Œã¯ãƒ¡ã‚½ãƒƒãƒ‰ã®å€™è£œãŒçµã‚‰ã‚Œã‚‹
![](https://storage.googleapis.com/zenn-user-upload/vgft7rkrh09ba50c3rx8hxthslqd)

- ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æƒ…å ±ã‚‚è¡¨ç¤ºã•ã‚Œã‚‹
![](https://storage.googleapis.com/zenn-user-upload/vha28w6ne7g9s05u2bqvpnsdl9v4)

- bodyã«è¨­å®šã™ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚‚å…¨éƒ¨å‡ºã‚‹
![](https://storage.googleapis.com/zenn-user-upload/twd16pwgq3z178kgmzul4gupmiuv)

- æˆ»ã‚Šå€¤ã‚‚å½“ç„¶å‹æƒ…å ±ãŒæä¾›ã•ã‚Œã‚‹
![](https://storage.googleapis.com/zenn-user-upload/iiip2fi9hndko5ih8zylhmrjfogn)

- codeã‚’åˆ¤åˆ¥ã™ã‚‹ã¨ãƒ‡ãƒ¼ã‚¿ã®ç¨®é¡ãŒçµã‚‰ã‚Œã‚‹
![](https://storage.googleapis.com/zenn-user-upload/uyyzjcv72biw1w7pfmvhns3u5x97)

ä»Šå›ã¯GitHubã®APIå®šç¾©ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ãŒã€OpenAPIv3ä»•æ§˜ã®å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Œã°ã€ãã®ä»–ã®APIã§ã‚‚åŒã˜ã‚ˆã†ã«åˆ©ç”¨å‡ºæ¥ã¾ã™ã€‚

# ã“ã®å‹å®šç¾©ã‚’è¡Œã†ãŸã‚ã®åœ°ç„ã®æ™¯è‰²

request-restapiã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ä½œã‚‰ã‚Œã¦ã„ã¾ã™ã€‚
ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã»ã¨ã‚“ã©ã¯å‹ã‚’ç®—å®šã™ã‚‹ãŸã‚ã®ã‚³ãƒ¼ãƒ‰ã§å ã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

```ts
import fetch from "node-fetch";

interface Props {
  baseUrl: string;
  authKey?: string;
  token?: string;
}

export class Rest<T> {
  private readonly baseUrl: string;
  private readonly authKey: string;
  private readonly token?: string;
  constructor({ baseUrl, token, authKey = "Bearer" }: Props) {
    this.baseUrl = baseUrl;
    this.authKey = authKey;
    this.token = token;
  }
  public request<
    P extends T,
    PATH extends keyof P,
    METHOD extends keyof P[PATH],
    RET extends P[PATH][METHOD] extends { responses: infer res }
      ? {
          [P in keyof res]: {
            code: P;
            headers: Headers;
            body: res[P] extends { schema: infer R }
              ? R
              : res[P] extends { content: { "application/json": infer R2 } }
              ? R2
              : Blob;
          };
        } extends {
          [P in string]: infer R;
        }
        ? R
        : never
      : never
  >({
    method,
    path,
    params,
    headers,
    query,
    body,
    token,
  }: {
    method: METHOD;
    path: PATH;
    params?: P[PATH][METHOD] extends { parameters: { path: infer R } }
      ? R extends { [M in keyof R]: R[M] }
        ? R
        : never
      : P[PATH] extends { parameters: { path: infer R } }
      ? R extends { [M in keyof R]: R[M] }
        ? R
        : never
      : never;
    headers?: P[PATH][METHOD] extends { parameters: { header: infer R } }
      ? R extends { [_ in string]: unknown }
        ? R
        : never
      : never;
    query?: P[PATH][METHOD] extends { parameters: { query: infer R } }
      ? R extends { [_ in string]: unknown }
        ? R
        : never
      : never;
    body?: P[PATH][METHOD] extends {
      requestBody: { content: { [key: string]: infer R } };
    }
      ? R
      : never;
    token?: string;
  }): Promise<RET> {
    const regularParam = params
      ? Object.entries(params).reduce(
          (p, [key, value]) =>
            p.replace(new RegExp(`\\{${key}\\}`), String(value)),
          path as string
        )
      : path;
    const queryParam = query
      ? Object.entries(query)
          .reduce((a, [key, value]) => `${a}${key}=${value}&`, "?")
          .trimEnd()
      : "";
    return fetch(this.baseUrl + regularParam + queryParam, {
      method: (method as string).toUpperCase(),
      headers: {
        "Content-Type": "application/json",
        ...(typeof headers === "object" ? headers : {}),
        ...(token || this.token
          ? { Authorization: `${this.authKey} ${token || this.token}` }
          : {}),
      },
      body: body && JSON.stringify(body),
    }).then(
      async (res) =>
        ({
          code: res.status,
          headers: res.headers,
          body: await res.json().catch(async () => await res.blob()),
        } as RET)
    );
  }
}
```

# ãªã‚“ã‹ã‚‚ã†TypeScriptã£ã¦é ‘å¼µã‚Œã°ä½•ã§ã‚‚ã‚ã‚Šãªã‚“ã˜ã‚ƒãªã„ã‹ã¨

TypeScriptã¯ãã‚“ãªè¨€èªã§ã™