---
title: "å··ã§ã¯ useEffect ã‚’æ°—è»½ã«ä½¿ã†ãªé¨’ãŒã—ã„ã€ãªã‚‰ã„ã£ãå®Œå…¨ã«ä½¿ã†ã®ã‚’ã‚„ã‚ã‚‹ã®ã¯ã©ã†ã ã‚ã†ï¼Ÿ"
emoji: "ğŸ”¥"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [nextjs, react, useeffect, typescript]
published: true
---

# ã‚ˆã—ã€ã“ã†ãªã£ãŸã‚‰æ„åœ°ã§ã‚‚ useEffect ã‚’ä½¿ã‚ãªã„ã

å‰å›ã¯ useEffect ã§ fetch ã‚’ä½¿ã‚ãªã„è¨˜äº‹ã‚’æ›¸ãã¾ã—ãŸã€‚

https://zenn.dev/sora_kumo/articles/next-react-fetch

ä»Šå›ã¯ã€ref ã§æ‹¾ã£ãŸãƒãƒ¼ãƒ‰ã«å¯¾ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ã‚‚ useEffect ç„¡ã—ã§æ›¸ã„ã¦ã¿ã¾ã™ã€‚`useSyncExternalStore`ã® subscribe ã«å®Ÿè³ª `useEffect` ã¨åŒç­‰ã®æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚ã‚¤ãƒ™ãƒ³ãƒˆã®æ¥ç¶šã‚„è§£é™¤ãŒå¿…è¦ã«ãªã£ãŸã‚‰ã€subscribe ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ›´æ–°ã™ã‚Œã°ã€ã‚³ãƒ¼ãƒ‰ãŒèª­ã¿ã‚„ã™ã„ã‹ã©ã†ã‹ã¯åº¦å¤–è¦–ã™ã‚‹ã¨ã—ã¦ã€åŒã˜ã‚ˆã†ãªã‚‚ã®ãŒã§ãã‚ãŒã‚Šã¾ã™ã€‚

ä»¥ä¸‹ã€ãƒãƒ¼ãƒ‰ã®ã‚µã‚¤ã‚ºå¤‰æ›´ã‚’æ¤œçŸ¥ã—ã¦è¡¨ç¤ºã™ã‚‹ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

https://github.com/SoraKumo001/next-node-event

![](/images/89f5e683952b79/2025-05-13-08-41-49.webp)

```tsx
"use client";
import { useRef, useSyncExternalStore } from "react";

export default function Page() {
  const storeCtx = useRef({
    subscribe: (onStoreChange: () => void) => {
      storeCtx.onStoreChange = onStoreChange;
      return () => {};
    },
    onStoreChange: () => {},
    ref: (node: HTMLDivElement | null) => {
      if (node) {
        storeCtx.subscribe = () => {
          const observer = new ResizeObserver(() => {
            storeCtx.data = {
              width: node.offsetWidth,
              height: node.offsetHeight,
            };
            storeCtx.onStoreChange();
          });
          observer.observe(node);
          return () => observer.disconnect();
        };
        storeCtx.data = {
          width: node.offsetWidth,
          height: node.offsetHeight,
        };
      }
    },
    data: { width: 0, height: 0 },
  }).current;
  const data = useSyncExternalStore(
    storeCtx.subscribe,
    () => storeCtx.data,
    () => storeCtx.data
  );
  return (
    <div className="whitespace-pre" ref={storeCtx.ref}>
      {JSON.stringify(data, null, 4)}
    </div>
  );
}
```

# ã¾ã¨ã‚

https://react.dev/reference/react/useSyncExternalStore

ä¸Šè¨˜ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã‚‚ React å¤–ã®å¤–éƒ¨ã‚¹ãƒˆã‚¢ã®ãƒ‡ãƒ¼ã‚¿èª­ã¿å–ã‚‹å ´åˆã¯ `useSyncExternalStore` ãŒä½¿ãˆã‚‹ã¨æ›¸ã„ã¦ã‚ã‚Šã¾ã™ã€‚å¿ƒç½®ããªã `useSyncExternalStore` ã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚ã•ã‚ã€ä»Šã“ã useEffect ã‚’ä½¿ã‚ãªã„ã‚³ãƒ¼ãƒ‰ã®ä¸–ç•Œã¸ï¼

ç‚ä¸Šã€ç‚ä¸Šï¼
