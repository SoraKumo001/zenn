---
title: "Next.js 13のapp/Directory(beta)と従来のpagesの違い"
emoji: "🐡"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [react,nextjs,nextjs13]
published: true
---

# 前提となる用語

ServerComponentsで出てくるコンポーネントは以下の三種類です

- Server Components
  HTMLで出力され、Streaming以外での書き換えは不可
  サーバ側で非同期データを扱える
  取得したデータは`Client Components`に引き渡すことが出来る
- Client Components
  サーバ側では動作しないので、初期HTMLには含まれない
　クライアント上のみで動作
- Shared Components
  一般のコンポーネント
  配置した場所によって`Server Components`になったり、`Client Components`になったりする


Next.jsの機能を比較するにはもう一種類付け足す必要があります

- Mix Components　←　勝手に命名
  HTMLで出力され、クライアント側でComponentとしてマウントされる

Next.jsでプログラムを組む際は、`Mix Components`を当たり前のように使っていますが、appではその機能が無くなります。

# appとpagesの違い

- app
  デフォルトで`Server Components`、宣言追加で`Client Components`
  `Mix Components`は使えない
- pages
  `Mix Components`で開始
  HTML出力抑止のためには`dynamic(…, { ssr: false })`などの対応が必要
  `Server Components`や`Client Components`を使うことも可能

Next.jsでSSRを使う場合の従来のプログラムの組み方は、静的HTMLを吐き出した後にその内容をコンポーネントから操作するという流れです。ところがappフォルダにコンポーネントを配置すると`Mix Components`が使えません。動かざること山のごとしな`Server Components`を使うか、初期HTMLには含まれない`Client Components`を使うかという二択になります。

「非同期の初期データをレンダリングに含めたいけど、後から動的に変更したい」という場合、データの取得と配布を`Server Components`に、後は`Client Components`に任せるという形になります。ただ、`Client Components`に任せた部分は、初期HTMLには含まれないので注意が必要です。

初期HTMLに含まれないと問題になるのが、モバイルレンダリングの高速化やJavaScriptを理解しない旧式のbot対策です。「ぶっちゃけどうするのコレ？」という感想です。

もちろん作るものによっては「動かざること山のごとし」や「初期HTMLイラネ」というものもあります。それならばたぶん、`Server Components`か`Client Components`のうち、片方に全振りすれば大丈夫です。しかし療法を必要とする場合は、バランス取りで苦労することになるでしょう。

# まとめ

`app/Directory(beta)`はあくまでbeta機能なので、今後便利に扱えるようになる可能性があります。しかし現在あるシステムを颯爽とappフォルダに移動しようとすれば、茨の道が待っていることは間違いありません。知恵と勇気をもって茨を抜けた先に待っている姫はビッグ・マムかもしれません。
